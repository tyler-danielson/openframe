<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#1e293b" />
    <meta name="description" content="OpenFrame - Self-hosted calendar dashboard" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <title>OpenFrame</title>
  </head>
  <body>
    <div id="root"><p id="diag" style="padding:40px;font-family:monospace;font-size:16px;color:#666">OpenFrame loading...</p></div>
    <script>
      // Diagnostic: catch ALL types of errors
      var diagLog = [];
      function showDiag(msg) {
        diagLog.push(msg);
        var el = document.getElementById('diag');
        if (!el) {
          el = document.createElement('pre');
          el.id = 'diag';
          document.body.prepend(el);
        }
        el.style.cssText = 'padding:20px;font-family:monospace;font-size:13px;color:#ff6b6b;background:#1a1a2e;white-space:pre-wrap;position:fixed;inset:0;overflow:auto;z-index:99999;';
        el.textContent = diagLog.join('\n\n');
      }

      // Catch classic script errors
      window.onerror = function(msg, url, line, col, error) {
        showDiag('WINDOW ERROR: ' + msg + '\nURL: ' + url + '\nLine: ' + line + ':' + col + '\n' + (error && error.stack ? error.stack : ''));
      };

      // Catch unhandled promise rejections
      window.addEventListener('unhandledrejection', function(e) {
        showDiag('PROMISE REJECTION: ' + (e.reason && e.reason.stack ? e.reason.stack : String(e.reason)));
      });

      // Catch module script load failures
      document.addEventListener('error', function(e) {
        if (e.target && e.target.tagName === 'SCRIPT') {
          showDiag('SCRIPT LOAD ERROR: Failed to load ' + (e.target.src || 'inline script'));
        }
      }, true);

      // Timeout: if React hasn't mounted in 10 seconds, show diagnostic
      setTimeout(function() {
        var root = document.getElementById('root');
        var diag = document.getElementById('diag');
        if (diag && root && root.contains(diag)) {
          showDiag('TIMEOUT: React did not mount within 10 seconds.\nThis usually means the JS module failed to load or evaluate.\n\nCheck browser console (F12) for errors.\n\nDiagnostic info:\n- URL: ' + location.href + '\n- UA: ' + navigator.userAgent + '\n- Module support: ' + ('noModule' in HTMLScriptElement.prototype));
        }
      }, 10000);
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
